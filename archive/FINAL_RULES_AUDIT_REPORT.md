# RingRift Final Rules Audit Report

**Date:** November 24, 2025
**Auditor:** Lead Integrator Agent
**Version:** 1.0

---

## 1. Executive Summary

The RingRift project has achieved a **high degree of rule fidelity** in its core engine implementation. The shared TypeScript engine, backend orchestration, and client sandbox are fundamentally sound and aligned with the Canonical Rules Specification (`RR-CANON`).

**Key Strengths:**

- **Robust Core Logic:** The shared engine modules (`core`, `movementLogic`, `captureLogic`, `lineDetection`) faithfully implement complex geometry and state transitions.
- **Strong Verification:** A comprehensive suite of static analysis, dynamic scenario tests, and Python-based strict invariants ensures that legal gameplay remains within bounds.
- **Parity:** The backend and sandbox are semantically aligned for all major rule clusters, ensuring a consistent experience across modes.

**Critical Risks:**

- **The "False Interface" Problem:** While the engine enforces rules correctly, the **Player UX and Documentation** actively mislead users about critical mechanics (e.g., suggesting mandatory moves are optional, misstating victory thresholds).
- **Defensive "Repairs":** The `BoardManager` silently deletes overlapping markers to "repair" invalid states. While currently benign, this hides potential bugs and complicates formal verification.
- **Implementation Compromises:** Minor deviations exist in placement caps (approximated by stack height) and "Last Player Standing" victory (implemented via play-to-completion rather than early termination).

**Overall Assessment:** The game is **playable and mechanically sound**, but the **user-facing layer is untrustworthy** regarding specific rule details.

---

## 2. Rules Traceability Matrix

| Rule ID       | Cluster     | Status      | Implementation Component        | Verification                       | Issues / Notes                                         |
| :------------ | :---------- | :---------- | :------------------------------ | :--------------------------------- | :----------------------------------------------------- |
| **R001–R003** | Geometry    | **Full**    | `BoardManager`, `core.ts`       | Static: Pass<br>Dyn: Strong        |                                                        |
| **R020–R023** | Stacks      | **Full**    | `core.ts`, `types`              | Static: Pass<br>Dyn: Strong        | [CCE-002] Placement cap approx                         |
| **R030–R031** | Markers     | **Full**    | `BoardManager`                  | Static: Pass<br>Dyn: Weak (Repair) | [CCE-001] Silent board repairs                         |
| **R040–R041** | Regions     | **Full**    | `territoryDetection`            | Static: Pass<br>Dyn: Strong        |                                                        |
| **R050–R052** | State       | **Full**    | `types`, `BoardManager`         | Static: Pass<br>Dyn: Strong        |                                                        |
| **R060–R062** | Accounting  | **Full**    | `core.ts`, `victoryLogic`       | Static: Pass<br>Dyn: Strong        |                                                        |
| **R070–R072** | Turn/Phase  | **Full**    | `turnLogic`, `TurnEngine`       | Static: Pass<br>Dyn: Good          | [CCE-003] Sandbox skip implicit                        |
| **R080–R082** | Placement   | **Full**    | `PlacementValidator`            | Static: Pass<br>Dyn: Good          | [CCE-002] Cap approx                                   |
| **R090–R092** | Movement    | **Full**    | `movementLogic`                 | Static: Pass<br>Dyn: Strong        | [DOCUX-P5] Landing rule text                           |
| **R100**      | Forced Elim | **Full**    | `TurnEngine`                    | Static: Pass<br>Dyn: Good          | [CCE-007] Heuristic, [DOCUX-P6] FAQ error              |
| **R101–R103** | Capture     | **Full**    | `captureLogic`, `GameEngine`    | Static: Pass<br>Dyn: Strong        | [CCE-004] Helper stub, [DOCUX-P1] HUD error            |
| **R120–R122** | Lines       | **Full**    | `lineDetection`, `lineDecision` | Static: Pass<br>Dyn: Strong        | [DOCUX-P3] HUD vague                                   |
| **R140–R145** | Territory   | **Full**    | `territoryProcessing`           | Static: Pass<br>Dyn: Good          | [CCE-005] Implicit outside check, [DOCUX-P4] HUD vague |
| **R170–R171** | Victory     | **Full**    | `victoryLogic`                  | Static: Pass<br>Dyn: Strong        | [DOCUX-P2] Modal text error                            |
| **R172**      | Last Player | **Partial** | `victoryLogic` (implicit)       | Static: Fail<br>Dyn: Partial       | [CCE-006] No early termination                         |
| **R173**      | Stalemate   | **Full**    | `victoryLogic`                  | Static: Pass<br>Dyn: Partial       |                                                        |
| **R190–R191** | Invariants  | **Full**    | `core.ts` (S-inv)               | Static: Pass<br>Dyn: Strong        | [CCE-001] Repairs affect S-inv                         |

---

## 3. Consolidated Discrepancies & Risks

### Critical Severity (Must Fix Immediately)

- **DOCUX-P1 (Chain Capture Misinformation):** The GameHUD tells players they can "end your turn" during a chain capture. RR-CANON-R103 mandates continuation. This causes players to believe the game is broken when they cannot skip.
  - _Impact:_ High frustration, perceived bug.
  - _Fix:_ Update `GameHUD.tsx` to state "Continue capturing (Mandatory)".

### High Severity (Fix Before Release)

- **DOCUX-P2 (Victory Threshold Error):** Victory Modal claims players must eliminate "all" opponent rings. RR-CANON-R170 sets the threshold at >50%.
  - _Impact:_ Misleading strategic goals.
  - _Fix:_ Update `VictoryModal.tsx` text.
- **DOCUX-P5 (Rulebook Drift - Landing):** `ringrift_complete_rules.md` §10.2 implies restrictive landing rules for 19x19/Hex. RR-CANON-R091 unifies this.
  - _Impact:_ Players learning from the book will play sub-optimally or think the engine is wrong.
  - _Fix:_ Update markdown to match Unified Landing Rule.

### Medium Severity (Schedule Fix)

- **CCE-001 (Board Repair):** `BoardManager` silently deletes overlapping markers.
  - _Impact:_ Hides bugs; complicates debugging.
  - _Fix:_ Instrument repairs with a counter; fail CI if > 0.
- **CCE-006 (Last Player Standing):** R172 (early win for last active player) is not explicitly implemented; game continues to stalemate/elimination.
  - _Impact:_ Games last longer than necessary in rare edge cases.
  - _Fix:_ Decide to implement R172 explicitly or officially deprecate it in favor of play-to-completion.
- **CCE-003 (Sandbox Skip):** Sandbox lacks explicit `skip_placement` move representation.
  - _Impact:_ Parity tooling friction.
  - _Fix:_ Add parity tests for skip scenarios.

### Low Severity (Backlog)

- **CCE-002 (Placement Cap Approx):** Cap counts all rings in controlled stacks, not just own-color.
- **CCE-004 (Capture Helper Stub):** Shared helper exists but is unused.
- **CCE-005 (Territory Implicit Check):** "Outside" check relies on sequencing.

---

## 4. Strategic Recommendations

1.  **Prioritize UX Integrity:** The engine is better than the UI. The immediate focus must be on aligning the HUD and Rulebook with the actual, correct behavior of the engine.
2.  **Formalize "Defensive" Logic:** The board repair logic and placement approximations should be documented as official engineering decisions in `RULES_ENGINE_ARCHITECTURE.md` rather than existing as hidden behaviors.
3.  **Parity Hardening:** Continue to use the Python strict invariants to drive TS engine quality. The "Active No Moves" regression suite is a high-value asset that should be maintained.
4.  **Refactor Roadmap:**
    - Phase 1: Fix UX/Docs (Weakest Link).
    - Phase 2: Instrument Board Repair (CCE-001).
    - Phase 3: Implement Shared Capture Helpers (CCE-004).

---

## 5. Targeted Improvement Plan (The "Weakest Link")

**Identified Weakness:** **Player-Facing Rule Integrity (UX & Documentation)**

The audit reveals a dangerous gap where the game engine enforces rules correctly (e.g., mandatory chain captures), but the User Interface explicitly contradicts them (e.g., "End your turn" button). This creates a "False Interface" that is more damaging to player trust than engine bugs.

**Justification:**

- Users trust the UI over the manual. If the UI says "End Turn" and the button doesn't work (because the engine knows it's illegal), users report a bug.
- Users trust the manual over the code. If the manual says "Landing is restricted" and the game allows it, users report a bug.
- Fixing these is low-effort but high-impact for perceived quality.

**Subtasks:**

1.  **Fix HUD Chain Capture Text:**
    - Modify `src/client/components/GameHUD.tsx` (or relevant sub-component) to check for `chain_capture` phase.
    - Change prompt from "End your turn" to "Continue capturing (Mandatory)".
2.  **Fix Victory Modal Text:**
    - Modify `src/client/components/VictoryModal.tsx`.
    - Update description for Ring Elimination to ">50% of total rings" instead of "all".
3.  **Update Public Rulebook:**
    - Edit `ringrift_complete_rules.md`.
    - Rewrite §10.2 to reflect the Unified Landing Rule.
    - Update FAQ Q24 to clarify forced elimination is always possible if you control a stack.
4.  **Clarify Territory UX (Optional):**
    - If feasible, add a tooltip or text in `GameHUD` during `territory_processing` to explain the self-elimination cost.

---

## 3.6 Second-Pass Matrix Consistency Notes

This second-pass audit re-checked the Rules Traceability Matrix in light of the canonical rules list in [`RULES_CANONICAL_SPEC.md`](../RULES_CANONICAL_SPEC.md:1) and the implementation/verification artefacts:

- [`RULES_IMPLEMENTATION_MAPPING.md`](../docs/rules/RULES_IMPLEMENTATION_MAPPING.md:1)
- [`RULES_STATIC_VERIFICATION.md`](RULES_STATIC_VERIFICATION.md:1)
- [`RULES_DYNAMIC_VERIFICATION.md`](RULES_DYNAMIC_VERIFICATION.md:1)
- [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:1)

Key conclusions:

1. **Coverage and granularity**
   - The canonical ruleset consists of **46 distinct RR-CANON rules**:  
     `R001–R003, R010, R020–R023, R030–R031, R040–R041, R050–R052, R060–R062, R070–R072, R080–R082, R090–R092, R100–R103, R120–R122, R140–R145, R170–R173, R190–R191`.
   - Section 2’s original matrix operates at **cluster level** (ranges such as `R001–R003`, `R020–R023` etc.).
   - **Appendix A.2 (below) now provides a rule-by-rule traceability matrix** covering all 46 IDs individually. Where Appendix A.2 and Section 2 differ in emphasis, **Appendix A.2 is authoritative for per-rule status and traceability.**

2. **Status consistency**
   - For all rules **except `RR-CANON-R172`**, the combined evidence from implementation mapping, static analysis, dynamic scenarios, and consistency/edge-case reports supports a **status of “Full”**: the behaviour required by RR-CANON is implemented and exercised by tests, with any deviations limited to conservative approximations or defensive behaviours.
   - `RR-CANON-R172` (**Last-player-standing victory**) remains **“Partial”**:
     - The rules texts (Complete, Compact, Canonical) agree on an _early_ last-player-standing victory condition ([`RULES_CANONICAL_SPEC.md`](../RULES_CANONICAL_SPEC.md:425), [`ringrift_complete_rules.md`](../ringrift_complete_rules.md:1228)).
     - The current engine instead uses a **play-to-completion** strategy (ring-elimination, territory, or bare-board stalemate) and does **not** implement an explicit early R172 check, as analysed in [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:316) (CCE-006).
     - Appendix A.2 therefore records `RR-CANON-R172` as `Partial` with an explicit pointer to CCE-006.

3. **Linkage to known compromises and documentation gaps**
   - The rule-level rows in Appendix A.2 surface the following previously-identified compromises and documentation issues:
     - **CCE-001 Board repair / S-invariant interaction** – affects `R030–R031`, `R050–R052`, and `R191` via [`TypeScript.BoardManager.assertBoardInvariants()`](src/server/game/BoardManager.ts:94). See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:348) CCE-001.
     - **CCE-002 Placement cap approximation** – affects `R020–R023` and `R080–R082` (per-player ring cap enforced via total stack heights of controlled stacks). See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:362) CCE-002.
     - **CCE-003 Sandbox skip semantics** – relevant to `R070–R072` and `R080` (representation-level difference only; legality matches backend). See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:376) CCE-003.
     - **CCE-004 Capture-chain helper stub** – relevant to `R101–R103` (live behaviour correct in GameEngine/sandbox; shared helper not yet wired). See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:399) CCE-004.
     - **CCE-005 Territory self-elimination locality** – relevant to `R143–R145`. See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:331) CCE-005.
     - **CCE-006 Last-player-standing implementation compromise** – specific to `R172`. See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:428) CCE-006.
     - **CCE-007 Forced-elimination stack-selection heuristic** – relevant to `R100`. See [`RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:444) CCE-007.
   - Documentation drift items (**DOCUX-P1–P7**) from [`docs/supplementary/RULES_DOCS_UX_AUDIT.md`](../docs/supplementary/RULES_DOCS_UX_AUDIT.md:1) are cross-referenced on the rows for the rules they mis-describe (e.g., `R091–R092`, `R100`, `R120–R122`, `R170`).

4. **Net effect**
   - **No canonical rule IDs are missing** from implementation: every RR-CANON rule has at least one mapped implementation site and at least indirect test coverage.
   - The original cluster-level statuses in Section 2 are broadly correct, but **Appendix A.2 improves traceability and makes compromises explicit rule-by-rule**. Future verification work (especially for Python parity and sandbox UX) should treat Appendix A.2 as the starting point.

---

## A.2 Corrected Rules Traceability Matrix (Rule-Level)

This appendix provides a **per-rule** traceability matrix for all RR-CANON rules. It **supersedes** the cluster-level matrix in Section 2 for detailed rule-by-rule reasoning.

**Status legend**

- **Full** – Canonical semantics implemented and exercised by tests; any deviations are conservative or purely defensive and are documented in Issues / Notes.
- **Partial** – Core semantics present but with known gaps, compromises, or missing branches relative to RR-CANON.
- **Divergent** – Implementation intentionally diverges from RR-CANON semantics (none identified in this pass).
- **Missing** – No clear implementation or only speculative traces (none identified in this pass).

| Rule ID       | Summary (Canonical)                                                                    | Status      | Implementation Component(s)                                                                                                                                                                                                                                                                              | Verification                                                                                                                                                                             | Issues / Notes                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------ | :------------------------------------------------------------------------------------- | :---------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| RR-CANON-R001 | Board type configuration (`BoardType`, sizes, adjacencies, lineLength, ringsPerPlayer) | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1), [`TypeScript.BoardManager`](src/server/game/BoardManager.ts:37)                                                                                                                                                                                        | Static: [`archive/RULES_STATIC_VERIFICATION.md`](RULES_STATIC_VERIFICATION.md:76) §2.1; Dyn: [`archive/RULES_DYNAMIC_VERIFICATION.md`](RULES_DYNAMIC_VERIFICATION.md:30) §2.1            | No open issues; cluster-level row **R001–R003 Geometry** remains valid.                                                                                                                                                                                                                                                                                                                             |
| RR-CANON-R002 | Coordinate systems (square integer coords; hex cube coords)                            | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1), [`TypeScript.BoardManager.generateValidPositions`](src/server/game/BoardManager.ts:179)                                                                                                                                                                | Static: §2.1; Dyn: movement reachability tests on all board types                                                                                                                        | Covered by Geometry cluster; no additional inconsistencies.                                                                                                                                                                                                                                                                                                                                         |
| RR-CANON-R003 | Adjacency relations (movement, line, territory)                                        | **Full**    | [`TypeScript.core`](src/shared/engine/core.ts:1), [`TypeScript.BoardManager.getNeighbors`](src/server/game/BoardManager.ts:213), [`TypeScript.territoryDetection`](src/shared/engine/territoryDetection.ts:36)                                                                                           | Static: §2.1; Dyn: movement / line / territory scenario suites                                                                                                                           | Adjacency usage matches Compact Spec; no cross-doc contradictions.                                                                                                                                                                                                                                                                                                                                  |
| RR-CANON-R010 | Player identifiers and count (2–4 players; 3 default)                                  | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`players`, `PlayerId`), [`TypeScript.GameEngine`](src/server/game/GameEngine.ts:92), Python `RingRiftEnv`                                                                                                                                              | Static: Implicit in §2.1 models; Dyn: multi-player victory and territory tests                                                                                                           | All docs align on player counts; no semantics gaps found.                                                                                                                                                                                                                                                                                                                                           |
| RR-CANON-R020 | Rings per player by board type; rings start in hand                                    | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`BOARD_CONFIGS.ringsPerPlayer`), initial state helpers, Python configs                                                                                                                                                                                 | Static: §2.1 (ring accounting); Dyn: victory threshold and stalemate tests                                                                                                               | **CCE-002**: placement cap uses total height of **controlled stacks** (all colours) as an approximation of “rings on board”. Conservative; see [`docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:362).                                                                                                                                   |
| RR-CANON-R021 | Stack definition (ordered rings, one stack/marker/collapsed per cell)                  | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`RingStack`), [`TypeScript.BoardManager`](src/server/game/BoardManager.ts:37)                                                                                                                                                                          | Static: §2.1 invariants; Dyn: movement/capture/stack tests                                                                                                                               | Exclusivity enforced; see also board repair notes under R030–R031.                                                                                                                                                                                                                                                                                                                                  |
| RR-CANON-R022 | Control and cap height (top ring; consecutive top rings)                               | **Full**    | [`TypeScript.core.calculateCapHeight`](src/shared/engine/core.ts:1), [`TypeScript.types`](src/shared/types/game.ts:1)                                                                                                                                                                                    | Static: §2.1; Dyn: capture and mixed-stack tests                                                                                                                                         | Canonical resolution of FAQ Q16/Q24 is respected (forced elimination always has ≥1 cap ring).                                                                                                                                                                                                                                                                                                       |
| RR-CANON-R023 | Allowed stack mutations (placement, overtaking, eliminations)                          | **Full**    | [`TypeScript.core`](src/shared/engine/core.ts:1), [`TypeScript.captureLogic`](src/shared/engine/captureLogic.ts:1), elimination helpers in [`TypeScript.GameEngine`](src/server/game/GameEngine.ts:1729)                                                                                                 | Static: §2.1; Dyn: capture chain and elimination tests                                                                                                                                   | No evidence of illegal stack splits; behaviour matches Complete & Compact rules.                                                                                                                                                                                                                                                                                                                    |
| RR-CANON-R030 | Marker definition and creation (departure markers only)                                | **Full**    | [`TypeScript.core.applyMarkerEffectsAlongPathOnBoard`](src/shared/engine/core.ts:619), [`TypeScript.BoardManager.setMarker`](src/server/game/BoardManager.ts:325)                                                                                                                                        | Static: §2.1; Dyn: movement / landing-on-own-marker tests                                                                                                                                | **CCE-001**: backend **repairs** overlaps by deleting markers; legal trajectories should never rely on this. See [`docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:348).                                                                                                                                                                 |
| RR-CANON-R031 | Collapsed spaces, created only by lines/territory                                      | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`collapsedSpaces`), [`TypeScript.lineDecisionHelpers`](src/shared/engine/lineDecisionHelpers.ts:1), [`TypeScript.territoryProcessing`](src/shared/engine/territoryProcessing.ts:1)                                                                     | Static: §2.1; Dyn: line and territory tests                                                                                                                                              | Same repair caveat as R030; S-invariant proofs assume no illegal stack+collapsed overlaps.                                                                                                                                                                                                                                                                                                          |
| RR-CANON-R040 | Region definition (territoryAdjacency, non-collapsed)                                  | **Full**    | [`TypeScript.territoryDetection.findDisconnectedRegions`](src/shared/engine/territoryDetection.ts:36)                                                                                                                                                                                                    | Static: §2.1; Dyn: FAQ Q15 and mini-region tests                                                                                                                                         | Behaviour consistent with both Complete and Compact specs.                                                                                                                                                                                                                                                                                                                                          |
| RR-CANON-R041 | Territory counts per player (`territorySpaces`)                                        | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1), [`TypeScript.territoryProcessing.applyTerritoryRegion`](src/shared/engine/territoryProcessing.ts:172)                                                                                                                                                  | Static: §2.1; Dyn: territory victory / stalemate tests                                                                                                                                   | Accounting matches canonical `territoryVictoryThreshold`.                                                                                                                                                                                                                                                                                                                                           |
| RR-CANON-R050 | Required `BoardState` fields                                                           | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1), [`TypeScript.BoardManager`](src/server/game/BoardManager.ts:37)                                                                                                                                                                                        | Static: §2.1 invariants; Dyn: parity snapshots in backend/sandbox/Python                                                                                                                 | Fully realised; repair behaviour noted under R030–R031.                                                                                                                                                                                                                                                                                                                                             |
| RR-CANON-R051 | Required `GameState` fields                                                            | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1), initial state helpers, Python `GameEngine`                                                                                                                                                                                                             | Static: §2.1; Dyn: victory, stalemate, and parity tests                                                                                                                                  | No gaps; all required fields present in TS and Python engines.                                                                                                                                                                                                                                                                                                                                      |
| RR-CANON-R052 | State validity invariants (ring conservation, exclusivity)                             | **Full**    | [`TypeScript.BoardManager.assertBoardInvariants`](src/server/game/BoardManager.ts:94), [`TypeScript.core.computeProgressSnapshot`](src/shared/engine/core.ts:531)                                                                                                                                        | Static: §2.1; Dyn: invariant tests and soak runs                                                                                                                                         | **CCE-001**: invariant _repair_ can delete markers in illegal states; legal play remains faithful, but repairs should be instrumented.                                                                                                                                                                                                                                                              |
| RR-CANON-R060 | Ring-elimination accounting and causing player                                         | **Full**    | [`TypeScript.lineDecisionHelpers`](src/shared/engine/lineDecisionHelpers.ts:1), [`TypeScript.territoryProcessing`](src/shared/engine/territoryProcessing.ts:1), forced elimination helpers in [`TypeScript.GameEngine`](src/server/game/GameEngine.ts:1729)                                              | Static: §2.1; Dyn: elimination-victory and stalemate tests                                                                                                                               | Canonical choice for chain-region attribution (R145/R170) matches Compact Spec and Complete chain-reaction examples.                                                                                                                                                                                                                                                                                |
| RR-CANON-R061 | Ring-elimination victory threshold (>50% rings)                                        | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`victoryThreshold`), [`TypeScript.victoryLogic.evaluateVictory`](src/shared/engine/victoryLogic.ts:45)                                                                                                                                                 | Static: §2.1; Dyn: victory scenario suites                                                                                                                                               | **DOCUX-P2**: Victory modal text is currently misleading; engine behaviour matches RR-CANON.                                                                                                                                                                                                                                                                                                        |
| RR-CANON-R062 | Territory-control victory threshold (>50% spaces)                                      | **Full**    | [`TypeScript.types`](src/shared/types/game.ts:1) (`territoryVictoryThreshold`), [`TypeScript.victoryLogic.evaluateVictory`](src/shared/engine/victoryLogic.ts:45)                                                                                                                                        | Static: §2.1; Dyn: territory-victory scenarios                                                                                                                                           | Thresholds agree across Complete, Compact, and Canonical specs.                                                                                                                                                                                                                                                                                                                                     |
| RR-CANON-R070 | Turn phases (placement → movement/capture → lines → territory → victory)               | **Full**    | [`TypeScript.turnLogic.advanceTurnAndPhase`](src/shared/engine/turnLogic.ts:135), [`TypeScript.advanceGameForCurrentPlayer`](src/server/game/turn/TurnEngine.ts:91), sandbox `ClientSandboxEngine` turn helpers over shared `turnLogic`                                                                  | Static: [`archive/RULES_STATIC_VERIFICATION.md`](RULES_STATIC_VERIFICATION.md:282) §2.2; Dyn: turn-sequence tests and Python invariant soaks                                             | Phase ordering faithful; sandbox uses additional start-of-turn heuristics (**CCE-003**) but preserves legal action sets.                                                                                                                                                                                                                                                                            |
| RR-CANON-R071 | Deterministic phase progression within a turn                                          | **Full**    | Same as R070                                                                                                                                                                                                                                                                                             | Same as R070                                                                                                                                                                             | No stochastic phase decisions; tie-breaks are expressed as player choices (lines/regions/self-eliminations).                                                                                                                                                                                                                                                                                        |
| RR-CANON-R072 | Legal-action requirement and forced-elimination entry                                  | **Full**    | [`TypeScript.turnLogic`](src/shared/engine/turnLogic.ts:135) delegates, [`TypeScript.turn.processForcedElimination`](src/server/game/turn/TurnEngine.ts:286), sandbox forced-elimination helper                                                                                                          | Static: §2.2; Dyn: forced-elimination regression tests and Python strict “no-move” invariant                                                                                             | Engines only trigger forced elimination when **no** placement/move/capture exists and stacks are present, matching RR-CANON.                                                                                                                                                                                                                                                                        |
| RR-CANON-R080 | Placement mandatory/optional/forbidden                                                 | **Full**    | [`TypeScript.validatePlacementOnBoard`](src/shared/engine/validators/PlacementValidator.ts:76), [`TypeScript.RuleEngine`](src/server/game/RuleEngine.ts:752), sandbox placement helpers                                                                                                                  | Static: §2.3; Dyn: placement and FAQ Q17 tests                                                                                                                                           | Sandbox encodes “skip placement” implicitly (no `skip_placement` Move) – see **CCE-003**; semantics match backend.                                                                                                                                                                                                                                                                                  |
| RR-CANON-R081 | Placement on empty cell (1–3 rings, no-dead-placement)                                 | **Full**    | Same as R080 plus sandbox [`TypeScript.sandboxPlacement`](src/client/sandbox/sandboxPlacement.ts:29)                                                                                                                                                                                                     | Static: §2.3; Dyn: no-dead-placement scenarios                                                                                                                                           | **CCE-002**: per-player cap is enforced via controlled-stack heights, a conservative approximation.                                                                                                                                                                                                                                                                                                 |
| RR-CANON-R082 | Placement on existing stack (single ring, no-dead-placement)                           | **Full**    | Same as R080 plus [`TypeScript.RuleEngine.getValidRingPlacements`](src/server/game/RuleEngine.ts:839)                                                                                                                                                                                                    | Static: §2.3; Dyn: placement-on-stack tests                                                                                                                                              | Same cap approximation as R081; semantics otherwise faithful.                                                                                                                                                                                                                                                                                                                                       |
| RR-CANON-R090 | Movement availability (controlled stacks with at least one legal move)                 | **Full**    | [`TypeScript.movementLogic.enumerateSimpleMoveTargetsFromStack`](src/shared/engine/movementLogic.ts:55), [`TypeScript.core.hasAnyLegalMoveOrCaptureFromOnBoard`](src/shared/engine/core.ts:367)                                                                                                          | Static: §2.4 (cluster placeholder) plus mapping §3.4; Dyn: movement scenario matrix                                                                                                      | Availability logic shared across backend/sandbox/Python; no semantic gaps found.                                                                                                                                                                                                                                                                                                                    |
| RR-CANON-R091 | Path and distance for non-capture movement                                             | **Full**    | Same as R090 plus [`TypeScript.RuleEngine.processStackMovement`](src/server/game/RuleEngine.ts:426)                                                                                                                                                                                                      | Static: mapping §3.4; Dyn: movement/shared tests and open-board reachability                                                                                                             | **DOCUX-P5**: Complete Rules §10.2 contains outdated landing prose; Canonical + Compact + engine agree on unified rule.                                                                                                                                                                                                                                                                             |
| RR-CANON-R092 | Marker interaction during non-capture movement (flip/collapse/landing-on-own-marker)   | **Full**    | [`TypeScript.core.applyMarkerEffectsAlongPathOnBoard`](src/shared/engine/core.ts:619), backend and sandbox movement engines                                                                                                                                                                              | Static: mapping §3.4; Dyn: marker and landing-on-own-marker tests                                                                                                                        | S-invariant reasoning in R191 relies on this implementation; behaviour matches Canonical.                                                                                                                                                                                                                                                                                                           |
| RR-CANON-R100 | Forced elimination when blocked                                                        | **Full**    | [`TypeScript.turn.processForcedElimination`](src/server/game/turn/TurnEngine.ts:286), [`TypeScript.ClientSandboxEngine.forceEliminateCap`](src/client/sandbox/ClientSandboxEngine.ts:888)                                                                                                                | Static: §2.2; Dyn: forced-elimination regression tests                                                                                                                                   | Stack selection uses a deterministic “smallest cap first” heuristic (**CCE-007**), which is allowed by RR-CANON but not player-visible today.                                                                                                                                                                                                                                                       |
| RR-CANON-R101 | Single overtaking capture segment legality                                             | **Full**    | [`TypeScript.core.validateCaptureSegmentOnBoard`](src/shared/engine/core.ts:202), [`TypeScript.captureLogic.enumerateCaptureMoves`](src/shared/engine/captureLogic.ts:26)                                                                                                                                | Static: mapping §3.5; Dyn: capture legality tests                                                                                                                                        | No unresolved contradictions between Complete and Compact specs; canonical semantics fully encoded.                                                                                                                                                                                                                                                                                                 |
| RR-CANON-R102 | Applying a capture segment (markers, move, ring transfer)                              | **Full**    | [`TypeScript.GameEngine.performOvertakingCapture`](src/server/game/GameEngine.ts:1059), sandbox [`TypeScript.sandboxCaptures.applyCaptureSegmentOnBoard`](src/client/sandbox/sandboxCaptures.ts:98)                                                                                                      | Static: mapping §3.5; Dyn: FAQ Q2–Q6, capture scenarios                                                                                                                                  | Landing-on-own-marker elimination is handled consistently with R092.                                                                                                                                                                                                                                                                                                                                |
| RR-CANON-R103 | Chain overtaking rule (mandatory continuation while legal)                             | **Full**    | Backend chain state in [`TypeScript.GameEngine`](src/server/game/GameEngine.ts:92), sandbox [`TypeScript.sandboxMovementEngine.performCaptureChainSandbox`](src/client/sandbox/sandboxMovementEngine.ts:400)                                                                                             | Static: mapping §3.5; Dyn: FAQ Q15 (180° reversal, cyclic), chain-capture tests                                                                                                          | **CCE-004**: shared `captureChainHelpers` is currently a stub; live engines implement R103 correctly.                                                                                                                                                                                                                                                                                               |
| RR-CANON-R120 | Line definition and detection                                                          | **Full**    | [`TypeScript.lineDetection.findAllLines`](src/shared/engine/lineDetection.ts:21), [`TypeScript.sandboxLines.findAllLinesOnBoard`](src/client/sandbox/sandboxLines.ts:124)                                                                                                                                | Static: mapping §3.6; Dyn: line-detection unit and scenario tests                                                                                                                        | Parameterised lineLength fully aligns with R001 and Compact Spec.                                                                                                                                                                                                                                                                                                                                   |
| RR-CANON-R121 | Line processing order (player-chosen, repeated until none remain)                      | **Full**    | [`TypeScript.lineDecisionHelpers`](src/shared/engine/lineDecisionHelpers.ts:1), backend/sandbox line engines                                                                                                                                                                                             | Static: mapping §3.6; Dyn: multiple-line and intersection scenarios                                                                                                                      | **DOCUX-P3**: HUD text currently overstates choice for exact-length lines; engine semantics match R121–R122.                                                                                                                                                                                                                                                                                        |
| RR-CANON-R122 | Line collapse and elimination (exact vs overlength; Options 1 and 2)                   | **Full**    | Same as R121                                                                                                                                                                                                                                                                                             | Static: mapping §3.6; Dyn: FAQ Q7, graduated-reward tests                                                                                                                                | Canonical interpretation (Option 2 allowed even when elimination is impossible) is implemented; no remaining ambiguity.                                                                                                                                                                                                                                                                             |
| RR-CANON-R140 | Region discovery (territoryAdjacency, non-collapsed)                                   | **Full**    | [`TypeScript.territoryDetection.findDisconnectedRegions`](src/shared/engine/territoryDetection.ts:36), backend/sandbox adapters                                                                                                                                                                          | Static: mapping §3.7; Dyn: territory-disconnection tests                                                                                                                                 | No contradictions beyond those already resolved in Canonical §11–12.                                                                                                                                                                                                                                                                                                                                |
| RR-CANON-R141 | Physical disconnection (single border colour + collapsed/edge)                         | **Full**    | Same as R140 plus [`TypeScript.territoryBorders`](src/shared/engine/territoryBorders.ts:1)                                                                                                                                                                                                               | Static: mapping §3.7; Dyn: FAQ Q15 and mini-region scenarios                                                                                                                             | Canonical border-marker scope (only markers on some blocking path) is implemented; older Complete wording treated as clarified.                                                                                                                                                                                                                                                                     |
| RR-CANON-R142 | Color-representation criterion (RegionColors ⊂ ActiveColors)                           | **Full**    | Same as R140                                                                                                                                                                                                                                                                                             | Static: mapping §3.7; Dyn: FAQ Q15 and multi-colour territory tests                                                                                                                      | Matches Compact Spec wording; Complete’s prose examples are consistent.                                                                                                                                                                                                                                                                                                                             |
| RR-CANON-R143 | Self-elimination prerequisite (hypothetical outside ring/cap)                          | **Full**    | [`TypeScript.territoryProcessing.canProcessTerritoryRegion`](src/shared/engine/territoryProcessing.ts:99), [`TypeScript.territoryDecisionHelpers`](src/shared/engine/territoryDecisionHelpers.ts:123)                                                                                                    | Static: mapping §3.7; Dyn: FAQ Q23 and RulesMatrix territory tests                                                                                                                       | Behaviour matches canonical “outside-only” prerequisite; see **CCE-005** for sequencing details.                                                                                                                                                                                                                                                                                                    |
| RR-CANON-R144 | Region processing order and per-region optionality                                     | **Full**    | [`TypeScript.territoryDecisionHelpers.enumerateProcessTerritoryRegionMoves`](src/shared/engine/territoryDecisionHelpers.ts:123), backend/sandbox territory engines                                                                                                                                       | Static: mapping §3.7; Dyn: multi-region and chain-reaction tests                                                                                                                         | Canonical choice (“may process any subset in any order”) is fully implemented.                                                                                                                                                                                                                                                                                                                      |
| RR-CANON-R145 | Region collapse, border-marker collapse, elimination and self-elimination              | **Full**    | [`TypeScript.territoryProcessing.applyTerritoryRegion`](src/shared/engine/territoryProcessing.ts:172), [`TypeScript.territoryDecisionHelpers.applyProcessTerritoryRegionDecision`](src/shared/engine/territoryDecisionHelpers.ts:234)                                                                    | Static: mapping §3.7; Dyn: territory chain-reaction scenarios                                                                                                                            | Attribution of eliminated rings to moving player matches canonical resolution of Complete/Compact ambiguity.                                                                                                                                                                                                                                                                                        |
| RR-CANON-R170 | Ring-elimination victory                                                               | **Full**    | [`TypeScript.victoryLogic.evaluateVictory`](src/shared/engine/victoryLogic.ts:45), backend/sandbox victory wrappers, Python `GameEngine`                                                                                                                                                                 | Static: mapping §3.8; Dyn: victory scenario suites                                                                                                                                       | **DOCUX-P2**: rulebook/UI text must be updated; engine semantics match R170.                                                                                                                                                                                                                                                                                                                        |
| RR-CANON-R171 | Territory-control victory                                                              | **Full**    | Same as R170                                                                                                                                                                                                                                                                                             | Static: mapping §3.8; Dyn: territory-victory tests                                                                                                                                       | No contradictions or compromises identified.                                                                                                                                                                                                                                                                                                                                                        |
| RR-CANON-R172 | Last-player-standing victory                                                           | **Partial** | [`TypeScript.victoryLogic.evaluateVictory`](src/shared/engine/victoryLogic.ts:45), Python `GameEngine`                                                                                                                                                                                                   | Static: [`docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md`](../docs/supplementary/RULES_CONSISTENCY_EDGE_CASES.md:316) CCE-006; Dyn: limited scenarios (no explicit early R172 check) | Canonical rules (Complete, Compact, Canonical) define an _early_ last-player-standing win; engines currently implement **play-to-completion** without explicit R172 detection. Design decision required on whether to (a) add explicit R172 handling, or (b) relax Canonical spec to match current behaviour (see CLAR item to be defined in `docs/supplementary/RULES_RULESET_CLARIFICATIONS.md`). |
| RR-CANON-R173 | Global stalemate and tiebreak ladder                                                   | **Full**    | [`TypeScript.victoryLogic.evaluateVictory`](src/shared/engine/victoryLogic.ts:45)                                                                                                                                                                                                                        | Static: mapping §3.8; Dyn: stalemate and tiebreak tests                                                                                                                                  | Behaviour matches Canonical ladders for 2–4 players; additional 3+ player scenarios are recommended but not semantics-blocking.                                                                                                                                                                                                                                                                     |
| RR-CANON-R190 | No randomness (deterministic rules; AI randomness outside transition system)           | **Full**    | Architectural contract across shared engine modules, [`TypeScript.core`](src/shared/engine/core.ts:1), [`TypeScript.victoryLogic`](src/shared/engine/victoryLogic.ts:45); AI randomness confined to [`TypeScript.localAIMoveSelection`](src/shared/engine/localAIMoveSelection.ts:1) and Python training | Static: mapping §3.8; Dyn: TS↔Python parity and deterministic replays                                                                                                                    | No runtime guard enforces “no randomness” inside the rules engine, but all core transitions are implemented deterministically. Canonical intent (no chance elements in the game rules) is satisfied.                                                                                                                                                                                                |
| RR-CANON-R191 | Progress and termination invariant (`S = M + C + E` monotone and bounded)              | **Full**    | [`TypeScript.core.computeProgressSnapshot`](src/shared/engine/core.ts:531), history and parity tooling in [`TypeScript.GameEngine`](src/server/game/GameEngine.ts:92) and [`TypeScript.ClientSandboxEngine`](src/client/sandbox/ClientSandboxEngine.ts:271)                                              | Static: mapping §3.8; Dyn: invariants and long-run soak tests                                                                                                                            | S is monotone on all **legal** moves. **CCE-001** notes that board repair can decrease S in illegal states; these are treated as engine bugs, not legal game trajectories.                                                                                                                                                                                                                          |
