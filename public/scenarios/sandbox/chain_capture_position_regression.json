{
  "id": "regression_chain_capture_position_filter",
  "name": "Chain Capture Position Filter Regression",
  "description": "Regression test: chain_capture phase at (6,6) with valid continuation to (5,5). Before fix, getValidMoves returned captures from ALL stacks instead of chainCapturePosition only.",
  "category": "chain_capture",
  "tags": ["regression", "chain_capture", "bug_fix", "2025-12-12"],
  "boardType": "square8",
  "playerCount": 2,
  "createdAt": "2025-12-12T07:34:11.949Z",
  "source": "custom",
  "state": {
    "gameId": "sandbox-local",
    "board": {
      "type": "square8",
      "size": 8,
      "stacks": {
        "6,2": {
          "position": {
            "x": 6,
            "y": 2
          },
          "rings": [2, 2, 2, 1, 1],
          "stackHeight": 5,
          "capHeight": 3,
          "controllingPlayer": 2
        },
        "3,6": {
          "position": {
            "x": 3,
            "y": 6
          },
          "rings": [1, 1, 1, 1],
          "stackHeight": 4,
          "capHeight": 4,
          "controllingPlayer": 1
        },
        "1,2": {
          "position": {
            "x": 1,
            "y": 2
          },
          "rings": [1, 1],
          "stackHeight": 2,
          "capHeight": 2,
          "controllingPlayer": 1
        },
        "0,0": {
          "position": {
            "x": 0,
            "y": 0
          },
          "rings": [1, 1, 1, 1, 2],
          "stackHeight": 5,
          "capHeight": 4,
          "controllingPlayer": 1
        },
        "6,6": {
          "position": {
            "x": 6,
            "y": 6
          },
          "rings": [2, 1],
          "stackHeight": 2,
          "capHeight": 1,
          "controllingPlayer": 2
        },
        "5,5": {
          "position": {
            "x": 5,
            "y": 5
          },
          "rings": [2],
          "stackHeight": 1,
          "capHeight": 1,
          "controllingPlayer": 2
        }
      },
      "markers": {
        "2,5": {
          "position": {
            "x": 2,
            "y": 5
          },
          "player": 1,
          "type": "regular"
        },
        "7,1": {
          "position": {
            "x": 7,
            "y": 1
          },
          "player": 2,
          "type": "regular"
        },
        "1,0": {
          "position": {
            "x": 1,
            "y": 0
          },
          "player": 2,
          "type": "regular"
        },
        "1,7": {
          "position": {
            "x": 1,
            "y": 7
          },
          "player": 2,
          "type": "regular"
        },
        "4,6": {
          "position": {
            "x": 4,
            "y": 6
          },
          "player": 1,
          "type": "regular"
        },
        "0,6": {
          "position": {
            "x": 0,
            "y": 6
          },
          "player": 1,
          "type": "regular"
        },
        "5,2": {
          "position": {
            "x": 5,
            "y": 2
          },
          "player": 2,
          "type": "regular"
        },
        "4,4": {
          "position": {
            "x": 4,
            "y": 4
          },
          "player": 2,
          "type": "regular"
        },
        "3,3": {
          "position": {
            "x": 3,
            "y": 3
          },
          "player": 2,
          "type": "regular"
        }
      },
      "collapsedSpaces": {
        "3,4": 1,
        "2,1": 2,
        "1,3": 2,
        "4,5": 2,
        "5,4": 2,
        "6,3": 2,
        "5,3": 2,
        "3,1": 2,
        "4,1": 2,
        "5,1": 2,
        "1,1": 1
      },
      "eliminatedRings": {},
      "formedLines": []
    },
    "players": [
      {
        "playerNumber": 1,
        "ringsInHand": 5,
        "eliminatedRings": 0,
        "territorySpaces": 0,
        "isActive": true
      },
      {
        "playerNumber": 2,
        "ringsInHand": 12,
        "eliminatedRings": 0,
        "territorySpaces": 6,
        "isActive": true
      }
    ],
    "currentPlayer": 2,
    "currentPhase": "chain_capture",
    "turnNumber": 37,
    "moveHistory": [
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 3,
          "y": 4
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:30:47.628Z",
        "thinkTime": 0,
        "moveNumber": 1
      },
      {
        "id": "move-3,4-4,4-2",
        "type": "move_stack",
        "player": 1,
        "from": {
          "x": 3,
          "y": 4
        },
        "to": {
          "x": 4,
          "y": 4
        },
        "moveNumber": 2,
        "timestamp": "2025-12-12T07:30:50.365Z",
        "thinkTime": 0
      },
      {
        "id": "swap_sides-3",
        "type": "swap_sides",
        "player": 2,
        "to": {
          "x": 0,
          "y": 0
        },
        "timestamp": "2025-12-12T07:30:50.369Z",
        "thinkTime": 0,
        "moveNumber": 3
      },
      {
        "id": "swap_sides-3",
        "type": "swap_sides",
        "player": 2,
        "to": {
          "x": 0,
          "y": 0
        },
        "timestamp": "2025-12-12T07:30:50.369Z",
        "thinkTime": 0,
        "moveNumber": 3
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 4,
          "y": 5
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:30:56.839Z",
        "thinkTime": 0,
        "moveNumber": 4
      },
      {
        "id": "capture-4,5-4,4-4,3-6",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 4,
          "y": 5
        },
        "captureTarget": {
          "x": 4,
          "y": 4
        },
        "to": {
          "x": 4,
          "y": 3
        },
        "timestamp": "2025-12-12T07:30:58.319Z",
        "thinkTime": 0,
        "moveNumber": 6
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 2,
          "y": 5
        },
        "placementCount": 1,
        "timestamp": "2025-12-12T07:30:58.322Z",
        "thinkTime": 0,
        "moveNumber": 6
      },
      {
        "id": "",
        "type": "overtaking_capture",
        "player": 1,
        "from": {
          "x": 2,
          "y": 5
        },
        "captureTarget": {
          "x": 4,
          "y": 3
        },
        "to": {
          "x": 6,
          "y": 1
        },
        "timestamp": "2025-12-12T07:30:58.429Z",
        "thinkTime": 0,
        "moveNumber": 7
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 5,
          "y": 4
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:31:05.639Z",
        "thinkTime": 0,
        "moveNumber": 8
      },
      {
        "id": "capture-5,4-4,3-2,1-10",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 5,
          "y": 4
        },
        "captureTarget": {
          "x": 4,
          "y": 3
        },
        "to": {
          "x": 2,
          "y": 1
        },
        "timestamp": "2025-12-12T07:31:08.269Z",
        "thinkTime": 0,
        "moveNumber": 10
      },
      {
        "id": "continue_capture_segment-2,1-6,1-7,1-10",
        "type": "continue_capture_segment",
        "player": 2,
        "from": {
          "x": 2,
          "y": 1
        },
        "captureTarget": {
          "x": 6,
          "y": 1
        },
        "to": {
          "x": 7,
          "y": 1
        },
        "timestamp": "2025-12-12T07:31:08.270Z",
        "thinkTime": 0,
        "moveNumber": 10
      },
      {
        "id": "continue_capture_segment-7,1-6,1-1,1-11",
        "type": "continue_capture_segment",
        "player": 2,
        "from": {
          "x": 7,
          "y": 1
        },
        "captureTarget": {
          "x": 6,
          "y": 1
        },
        "to": {
          "x": 1,
          "y": 1
        },
        "timestamp": "2025-12-12T07:31:09.923Z",
        "thinkTime": 0,
        "moveNumber": 11
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 5,
          "y": 3
        },
        "placementCount": 3,
        "timestamp": "2025-12-12T07:31:17.901Z",
        "thinkTime": 0,
        "moveNumber": 12
      },
      {
        "id": "",
        "type": "move_stack",
        "player": 1,
        "from": {
          "x": 5,
          "y": 3
        },
        "to": {
          "x": 2,
          "y": 6
        },
        "moveNumber": 13,
        "timestamp": "2025-12-12T07:31:18.014Z",
        "thinkTime": 0
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 6,
          "y": 3
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:31:26.486Z",
        "thinkTime": 0,
        "moveNumber": 14
      },
      {
        "id": "move-6,3-1,3-16",
        "type": "move_stack",
        "player": 2,
        "from": {
          "x": 6,
          "y": 3
        },
        "to": {
          "x": 1,
          "y": 3
        },
        "moveNumber": 16,
        "timestamp": "2025-12-12T07:31:36.277Z",
        "thinkTime": 0
      },
      {
        "id": "capture-1,3-1,1-1,0-17",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 1,
          "y": 3
        },
        "captureTarget": {
          "x": 1,
          "y": 1
        },
        "to": {
          "x": 1,
          "y": 0
        },
        "timestamp": "2025-12-12T07:31:40.719Z",
        "thinkTime": 0,
        "moveNumber": 17
      },
      {
        "id": "continue_capture_segment-1,0-1,1-1,7-17",
        "type": "continue_capture_segment",
        "player": 2,
        "from": {
          "x": 1,
          "y": 0
        },
        "captureTarget": {
          "x": 1,
          "y": 1
        },
        "to": {
          "x": 1,
          "y": 7
        },
        "timestamp": "2025-12-12T07:31:40.719Z",
        "thinkTime": 0,
        "moveNumber": 17
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 4,
          "y": 1
        },
        "placementCount": 3,
        "timestamp": "2025-12-12T07:31:50.019Z",
        "thinkTime": 0,
        "moveNumber": 18
      },
      {
        "id": "",
        "type": "move_stack",
        "player": 1,
        "from": {
          "x": 1,
          "y": 1
        },
        "to": {
          "x": 5,
          "y": 5
        },
        "moveNumber": 19,
        "timestamp": "2025-12-12T07:31:50.132Z",
        "thinkTime": 0
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 1,
          "y": 7
        },
        "placementCount": 1,
        "placedOnStack": true,
        "timestamp": "2025-12-12T07:31:55.665Z",
        "thinkTime": 0,
        "moveNumber": 20
      },
      {
        "id": "capture-1,7-2,6-6,2-22",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 1,
          "y": 7
        },
        "captureTarget": {
          "x": 2,
          "y": 6
        },
        "to": {
          "x": 6,
          "y": 2
        },
        "timestamp": "2025-12-12T07:32:04.115Z",
        "thinkTime": 0,
        "moveNumber": 22
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 4,
          "y": 6
        },
        "placementCount": 2,
        "timestamp": "2025-12-12T07:32:04.118Z",
        "thinkTime": 0,
        "moveNumber": 22
      },
      {
        "id": "",
        "type": "overtaking_capture",
        "player": 1,
        "from": {
          "x": 4,
          "y": 6
        },
        "captureTarget": {
          "x": 2,
          "y": 6
        },
        "to": {
          "x": 0,
          "y": 6
        },
        "timestamp": "2025-12-12T07:32:04.229Z",
        "thinkTime": 0,
        "moveNumber": 23
      },
      {
        "id": "",
        "type": "continue_capture_segment",
        "player": 1,
        "from": {
          "x": 0,
          "y": 6
        },
        "captureTarget": {
          "x": 2,
          "y": 6
        },
        "to": {
          "x": 3,
          "y": 6
        },
        "timestamp": "2025-12-12T07:32:04.229Z",
        "thinkTime": 0,
        "moveNumber": 24
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 5,
          "y": 2
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:32:39.631Z",
        "thinkTime": 0,
        "moveNumber": 25
      },
      {
        "id": "move-5,2-3,2-27",
        "type": "move_stack",
        "player": 2,
        "from": {
          "x": 5,
          "y": 2
        },
        "to": {
          "x": 3,
          "y": 2
        },
        "moveNumber": 27,
        "timestamp": "2025-12-12T07:33:00.773Z",
        "thinkTime": 0
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 4,
          "y": 2
        },
        "placementCount": 1,
        "timestamp": "2025-12-12T07:33:00.776Z",
        "thinkTime": 0,
        "moveNumber": 27
      },
      {
        "id": "",
        "type": "overtaking_capture",
        "player": 1,
        "from": {
          "x": 4,
          "y": 1
        },
        "captureTarget": {
          "x": 4,
          "y": 2
        },
        "to": {
          "x": 4,
          "y": 4
        },
        "timestamp": "2025-12-12T07:33:00.891Z",
        "thinkTime": 0,
        "moveNumber": 28
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 2,
        "to": {
          "x": 5,
          "y": 1
        },
        "placementCount": 1,
        "placedOnStack": false,
        "timestamp": "2025-12-12T07:33:06.877Z",
        "thinkTime": 0,
        "moveNumber": 29
      },
      {
        "id": "move-5,1-3,1-31",
        "type": "move_stack",
        "player": 2,
        "from": {
          "x": 5,
          "y": 1
        },
        "to": {
          "x": 3,
          "y": 1
        },
        "moveNumber": 31,
        "timestamp": "2025-12-12T07:33:09.965Z",
        "thinkTime": 0
      },
      {
        "id": "capture-3,1-3,2-3,3-32",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 3,
          "y": 1
        },
        "captureTarget": {
          "x": 3,
          "y": 2
        },
        "to": {
          "x": 3,
          "y": 3
        },
        "timestamp": "2025-12-12T07:33:16.725Z",
        "thinkTime": 0,
        "moveNumber": 32
      },
      {
        "id": "",
        "type": "place_ring",
        "player": 1,
        "to": {
          "x": 1,
          "y": 2
        },
        "placementCount": 2,
        "timestamp": "2025-12-12T07:33:16.731Z",
        "thinkTime": 0,
        "moveNumber": 32
      },
      {
        "id": "",
        "type": "overtaking_capture",
        "player": 1,
        "from": {
          "x": 4,
          "y": 4
        },
        "captureTarget": {
          "x": 3,
          "y": 3
        },
        "to": {
          "x": 0,
          "y": 0
        },
        "timestamp": "2025-12-12T07:33:16.849Z",
        "thinkTime": 0,
        "moveNumber": 33
      },
      {
        "id": "skip-placement-1765524819996",
        "type": "skip_placement",
        "player": 2,
        "to": {
          "x": 0,
          "y": 0
        },
        "timestamp": "2025-12-12T07:33:39.996Z",
        "thinkTime": 0,
        "moveNumber": 34
      },
      {
        "id": "capture-3,3-5,5-6,6-36",
        "type": "overtaking_capture",
        "player": 2,
        "from": {
          "x": 3,
          "y": 3
        },
        "captureTarget": {
          "x": 5,
          "y": 5
        },
        "to": {
          "x": 6,
          "y": 6
        },
        "timestamp": "2025-12-12T07:33:39.997Z",
        "thinkTime": 0,
        "moveNumber": 36
      }
    ],
    "gameStatus": "active",
    "victoryThreshold": 19,
    "territoryVictoryThreshold": 33,
    "totalRingsEliminated": 0,
    "chainCapturePosition": {
      "x": 6,
      "y": 6
    }
  }
}
