
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'ringrift-p2p-monitor'
    leader_node: 'mac-studio'

rule_files:
  # - /etc/prometheus/alerting-rules.yaml

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: 'leader'

  # P2P orchestrator on all nodes
  - job_name: 'ringrift-p2p'
    static_configs:
      - targets: ['100.94.174.19:9091']
        labels:
          node="hetzner-cpu1"
      - targets: ['38.128.233.145:9091']
        labels:
          node="runpod-a100-1"
      - targets: ['104.255.9.187:9091']
        labels:
          node="runpod-a100-2"
      - targets: ['100.94.201.92:9091']
        labels:
          node="vultr-a100-20gb"
      - targets: ['217.171.200.22:9091']
        labels:
          node="vast-28889766"
      - targets: ['102.210.171.65:9091']
        labels:
          node="runpod-h100"
      - targets: ['213.173.105.7:9091']
        labels:
          node="runpod-a100-storage-1"
      - targets: ['84.0.194.24:9091']
        labels:
          node="vast-29129529"
      - targets: ['145.236.166.111:9091']
        labels:
          node="vast-28925166"
      - targets: ['100.67.131.72:9091']
        labels:
          node="hetzner-cpu2"
      - targets: ['1.208.108.242:9091']
        labels:
          node="vast-29031161"
      - targets: ['217.171.200.22:9091']
        labels:
          node="vast-29046315"
      - targets: ['211.72.13.201:9091']
        labels:
          node="vast-29129151"
      - targets: ['100.126.21.102:9091']
        labels:
          node="hetzner-cpu3"
      - targets: ['194.228.55.129:9091']
        labels:
          node="vast-29128356"
      - targets: ['76.66.207.49:9091']
        labels:
          node="vast-29126088"
      - targets: ['localhost:8770']
        labels:
          node="mac-studio", role="leader"

  # Node exporter on all nodes
  - job_name: 'node_exporter'
    static_configs:
      - targets: ['100.94.174.19:9100']
        labels:
          node="hetzner-cpu1"
      - targets: ['38.128.233.145:9100']
        labels:
          node="runpod-a100-1"
      - targets: ['104.255.9.187:9100']
        labels:
          node="runpod-a100-2"
      - targets: ['100.94.201.92:9100']
        labels:
          node="vultr-a100-20gb"
      - targets: ['217.171.200.22:9100']
        labels:
          node="vast-28889766"
      - targets: ['102.210.171.65:9100']
        labels:
          node="runpod-h100"
      - targets: ['213.173.105.7:9100']
        labels:
          node="runpod-a100-storage-1"
      - targets: ['84.0.194.24:9100']
        labels:
          node="vast-29129529"
      - targets: ['145.236.166.111:9100']
        labels:
          node="vast-28925166"
      - targets: ['100.67.131.72:9100']
        labels:
          node="hetzner-cpu2"
      - targets: ['1.208.108.242:9100']
        labels:
          node="vast-29031161"
      - targets: ['217.171.200.22:9100']
        labels:
          node="vast-29046315"
      - targets: ['211.72.13.201:9100']
        labels:
          node="vast-29129151"
      - targets: ['100.126.21.102:9100']
        labels:
          node="hetzner-cpu3"
      - targets: ['194.228.55.129:9100']
        labels:
          node="vast-29128356"
      - targets: ['76.66.207.49:9100']
        labels:
          node="vast-29126088"
      - targets: ['localhost:9100']
        labels:
          node="mac-studio", role="leader"

  # Unified AI loop (leader only by default)
  - job_name: 'ringrift-unified-loop'
    static_configs:
      - targets: ['localhost:9091']
        labels:
          instance: 'leader'
    scrape_interval: 15s

  # Elo metrics exporter (leader only)
  - job_name: 'ringrift-elo-metrics'
    static_configs:
      - targets: ['localhost:9092']
        labels:
          instance: 'leader'
    scrape_interval: 30s

  # Data quality monitor (leader only)
  - job_name: 'ringrift-data-quality'
    static_configs:
      - targets: ['localhost:9093']
        labels:
          instance: 'leader'
    scrape_interval: 60s

  # ==========================================================================
  # Prometheus Federation - scrape metrics from other Prometheus instances
  # This enables distributed monitoring where the leader aggregates metrics
  # from Prometheus instances running on other nodes (backup monitoring hosts)
  # ==========================================================================
  - job_name: 'prometheus-federation'
    honor_labels: true  # Preserve original labels from federated instances
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job=~"ringrift.*"}'  # All RingRift metrics
        - '{job="node_exporter"}'  # Node hardware metrics
        - '{__name__=~".*_total|.*_seconds|.*_bytes"}'  # Standard metrics
    static_configs:
      - targets: ['100.71.89.91:9090']
        labels:
          source_node="lambda-gh200-1"
      - targets: ['100.110.143.119:9090']
        labels:
          source_node="lambda-gh200-2"
      - targets: ['100.69.101.108:9090']
        labels:
          source_node="lambda-gh200-3"
    scrape_interval: 30s
    scrape_timeout: 25s
