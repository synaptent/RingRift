
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'ringrift-p2p-monitor'
    leader_node: 'local-mac'

rule_files:
  # - /etc/prometheus/alerting-rules.yaml

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: 'leader'

  # P2P orchestrator on all nodes
  - job_name: 'ringrift-p2p'
    static_configs:
      - targets: ['<node-ip-1>:9091']
        labels:
          node="gpu-node-1"
      - targets: ['<node-ip-2>:9091']
        labels:
          node="gpu-node-2"
      - targets: ['<node-ip-3>:9091']
        labels:
          node="gpu-node-3"
      - targets: ['<node-ip-4>:9091']
        labels:
          node="cpu-voter-1"
      - targets: ['localhost:8770']
        labels:
          node="local-mac", role="leader"

  # Node exporter on all nodes
  - job_name: 'node_exporter'
    static_configs:
      - targets: ['<node-ip-1>:9100']
        labels:
          node="gpu-node-1"
      - targets: ['<node-ip-2>:9100']
        labels:
          node="gpu-node-2"
      - targets: ['<node-ip-3>:9100']
        labels:
          node="gpu-node-3"
      - targets: ['<node-ip-4>:9100']
        labels:
          node="cpu-voter-1"
      - targets: ['localhost:9100']
        labels:
          node="local-mac", role="leader"

  # Unified AI loop (leader only by default)
  - job_name: 'ringrift-unified-loop'
    static_configs:
      - targets: ['localhost:9091']
        labels:
          instance: 'leader'
    scrape_interval: 15s

  # Elo metrics exporter (leader only)
  - job_name: 'ringrift-elo-metrics'
    static_configs:
      - targets: ['localhost:9092']
        labels:
          instance: 'leader'
    scrape_interval: 30s

  # Data quality monitor (leader only)
  - job_name: 'ringrift-data-quality'
    static_configs:
      - targets: ['localhost:9093']
        labels:
          instance: 'leader'
    scrape_interval: 60s

  # Prometheus Federation - scrape metrics from other Prometheus instances
  - job_name: 'prometheus-federation'
    honor_labels: true
    metrics_path: '/federate'
    params:
      'match[]':
        - '{job=~"ringrift.*"}'
        - '{job="node_exporter"}'
        - '{__name__=~".*_total|.*_seconds|.*_bytes"}'
    static_configs:
      - targets: ['<federation-node-1>:9090']
        labels:
          source_node="federation-node-1"
      - targets: ['<federation-node-2>:9090']
        labels:
          source_node="federation-node-2"
    scrape_interval: 30s
    scrape_timeout: 25s
