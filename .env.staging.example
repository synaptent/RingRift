# =============================================================================
# RingRift Staging Environment Template
# =============================================================================
#
# This is a TEMPLATE for staging environments. It contains placeholder values
# that MUST be replaced before deployment.
#
# Usage:
#   1. Copy this file to `.env.staging` in your staging environment
#   2. Replace ALL placeholder values below with real staging credentials
#   3. NEVER commit real credentials to version control
#
# For Docker Compose staging deployment:
#   docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d
# =============================================================================


# ---------------------------------------------------------------------------
# Core Server
# ---------------------------------------------------------------------------
NODE_ENV=production
PORT=3000
SOCKET_PORT=3001


# ---------------------------------------------------------------------------
# Database (PostgreSQL + Prisma)
# ---------------------------------------------------------------------------
# IMPORTANT: Replace with actual staging database credentials
# When running inside Docker Compose, use "postgres" as the host.

# Full connection URL for Prisma (replace <STAGING_DB_PASSWORD>)
DATABASE_URL=postgresql://ringrift:<STAGING_DB_PASSWORD>@postgres:5432/ringrift

# Individual components (some scripts use these)
DB_HOST=postgres
DB_PORT=5432
DB_NAME=ringrift
DB_USER=ringrift
# PLACEHOLDER - replace with actual staging password (16+ chars recommended)
DB_PASSWORD=<STAGING_DB_PASSWORD>


# ---------------------------------------------------------------------------
# Redis
# ---------------------------------------------------------------------------
# IMPORTANT: Replace with actual staging Redis credentials

REDIS_URL=redis://redis:6379
REDIS_HOST=redis
REDIS_PORT=6379
# PLACEHOLDER - replace with actual staging password (leave empty if no auth)
REDIS_PASSWORD=<STAGING_REDIS_PASSWORD>


# ---------------------------------------------------------------------------
# JWT / Authentication
# ---------------------------------------------------------------------------
# CRITICAL: Replace with unique, cryptographically secure secrets!
#
# Generate secrets with: openssl rand -base64 48
#
# Requirements:
# - Minimum 32 characters
# - Must be unique (not shared with production)
# - Must NOT be any of the placeholder values from .env.example

# PLACEHOLDER - replace with secure 48+ character random string
JWT_SECRET=<STAGING_JWT_SECRET_REPLACE_ME>
JWT_REFRESH_SECRET=<STAGING_JWT_REFRESH_SECRET_REPLACE_ME>

# Token expiration (can keep these defaults)
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d


# ---------------------------------------------------------------------------
# CORS / Client
# ---------------------------------------------------------------------------
# Update these for your staging domain

CORS_ORIGIN=http://localhost:3000
ALLOWED_ORIGINS=http://localhost:3000


# ---------------------------------------------------------------------------
# File Storage & Logging
# ---------------------------------------------------------------------------

UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880
LOG_LEVEL=info
LOG_FILE=./logs/app.log


# ---------------------------------------------------------------------------
# AI Service
# ---------------------------------------------------------------------------
# In Docker Compose, the backend connects to the AI service via internal DNS.

AI_SERVICE_URL=http://ai-service:8001
AI_SERVICE_PORT=8001
AI_LOG_LEVEL=INFO


# ---------------------------------------------------------------------------
# Rules Engine & Topology
# ---------------------------------------------------------------------------

# Staging orchestrator-first posture (Phase 1 from ORCHESTRATOR_ROLLOUT_PLAN.md):
# - TS shared engine authoritative (`RINGRIFT_RULES_MODE=ts`)
# - Orchestrator adapter enabled for all sessions
RINGRIFT_RULES_MODE=ts

# Single instance topology (default for staging)
RINGRIFT_APP_TOPOLOGY=single

# Orchestrator adapter for unified turn processing
# Enabled in staging for validation before production rollout
ORCHESTRATOR_ADAPTER_ENABLED=true

# Orchestrator rollout configuration for phased deployment
# Full rollout in staging for pre-production validation
ORCHESTRATOR_ROLLOUT_PERCENTAGE=100

# Shadow mode disabled in staging (use in development or dedicated jobs for parity testing)
ORCHESTRATOR_SHADOW_MODE_ENABLED=false

# Circuit breaker enabled for automatic failover on errors
ORCHESTRATOR_CIRCUIT_BREAKER_ENABLED=true

# Conservative error threshold for staging (5% error rate trips breaker)
ORCHESTRATOR_ERROR_THRESHOLD_PERCENT=5

# 5-minute error window for rate calculation
ORCHESTRATOR_ERROR_WINDOW_SECONDS=300

# Latency warning threshold (500ms P99)
ORCHESTRATOR_LATENCY_THRESHOLD_MS=500


# ---------------------------------------------------------------------------
# Monitoring & Grafana
# ---------------------------------------------------------------------------
# PLACEHOLDER - replace with secure password for Grafana admin
GRAFANA_PASSWORD=<STAGING_GRAFANA_PASSWORD>
GRAFANA_ROOT_URL=http://localhost:3002


# ---------------------------------------------------------------------------
# Load Testing Configuration
# ---------------------------------------------------------------------------
# Target scale (from PROJECT_GOALS.md):
# - 100 concurrent games
# - 300 concurrent players
#
# Set with headroom for burst testing:
MAX_CONCURRENT_GAMES=150
MAX_CONCURRENT_CONNECTIONS=400

# Rate limits - elevated for load testing while remaining production-realistic
RATE_LIMIT_API_POINTS=10000
RATE_LIMIT_API_AUTH_POINTS=10000
RATE_LIMIT_AUTH_POINTS=10000
RATE_LIMIT_AUTH_LOGIN_POINTS=10000
RATE_LIMIT_AUTH_REGISTER_POINTS=10000
RATE_LIMIT_GAME_POINTS=10000
RATE_LIMIT_GAME_CREATE_USER_POINTS=1000
RATE_LIMIT_GAME_CREATE_IP_POINTS=1000


# ---------------------------------------------------------------------------
# AI Service Configuration
# ---------------------------------------------------------------------------
AI_MAX_CONCURRENT_REQUESTS=50
AI_REQUEST_TIMEOUT=5000


# ---------------------------------------------------------------------------
# PostgreSQL Configuration
# ---------------------------------------------------------------------------
POSTGRES_DB=ringrift
POSTGRES_USER=ringrift
# PLACEHOLDER - replace with actual staging password
POSTGRES_PASSWORD=<STAGING_DB_PASSWORD>