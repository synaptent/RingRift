# AI service Python dependencies
# NOTE: This file is kept in sync with the narrative/status document
# `ai-service/DEPENDENCY_UPDATES.md` and the cross-repo plan in
# `docs/DEPENDENCY_UPGRADE_PLAN.md`. When changing pins here, update
# those docs (and re-run the guardrail test subsets) so that code,
# environment, and documentation remain aligned.

# Core FastAPI dependencies (Python 3.13 compatible)
fastapi==0.122.0
uvicorn[standard]==0.38.0
pydantic==2.10.5

# Utilities
python-dotenv==1.2.1
aiohttp==3.13.2
aiohttp-socks==0.10.1  # SOCKS proxy for userspace Tailscale in containers (Vast.ai, RunPod)
redis==7.1.0
httpx==0.28.1
prometheus_client==0.23.1
sdnotify==0.3.2  # Systemd watchdog notifications for P2P orchestrator

# Dashboard server
flask==3.1.3
flask-cors==5.0.0

# Development tools (Wave 3-A tooling stack validated with pytest 9.x)
pytest==9.0.1
pytest-asyncio==1.3.0
pytest-timeout==2.4.0  # Global test timeout for CI safety
pytest-cov==6.0.0  # Coverage reporting with pytest
hypothesis==6.116.0
black==25.12.0
flake8==7.3.0
mypy==1.13.0  # Static type checking for Python/TS parity
vulture==2.14  # Dead code detection
mutmut>=2.5.0,<3.0.0  # Mutation testing for test quality validation (2.x is more stable)
bandit>=1.7.0  # Security vulnerability scanner
safety>=3.0.0  # Dependency vulnerability checker
import-linter>=2.0  # Architecture/dependency validation

# Core ML/Data Science libraries (Latest versions with numpy 2.x)
numpy==2.2.6
scipy==1.15.3
scikit-learn==1.6.1

# Deep Learning for Self-Improving AI
# PyTorch - Neural networks for position evaluation and policy learning
# Note: torchvision 0.21.0 requires torch==2.9.1; this pair is validated for
# Python 3.10/3.11 and numpy 2.2.x via Wave 3-D (dl-torch) guardrails.
torch==2.9.1
torchvision==0.24.1

# TensorBoard - Training monitoring and visualization
tensorboard==2.18.0
tensorboardX==2.6.4

# PyTorch Geometric - Graph Neural Networks for territory connectivity modeling
# Install separately if needed: pip install torch-geometric torch-scatter torch-sparse
# These require matching PyTorch version (2.9.1); wheels auto-selected from PyG
torch-geometric>=2.6.0
torch-scatter>=2.1.0
torch-sparse>=0.6.0

# CMA-ES for heuristic weight optimization
cma>=3.3.0
# EvoTorch for GPU-native CMA-ES (v0.6.1+ supports Python 3.12/3.13)
# Note: If import fails on Python 3.13, use cma directly as fallback
evotorch>=0.6.1

# Note: stable-baselines3 removed - incompatible with numpy 2.x
# We'll implement RL algorithms directly using PyTorch instead
# This gives us more control and flexibility for RingRift-specific RL

# Model serialization and management
cloudpickle==3.1.0
h5py==3.13.0

# Data processing for game replay analysis
pandas==2.2.3
matplotlib==3.10.0

# Performance optimization
# Note: numba removed - not yet compatible with Python 3.13
# JIT compilation can be added later when numba supports Python 3.13

# Memory optimization for experience replay
msgpack==1.1.0
lz4==4.4.5

# Progress bars and monitoring
tqdm==4.67.1

# System monitoring
psutil==7.1.3

# Distributed training (cluster worker discovery)
zeroconf>=0.100.0

# P2P gossip-based membership (SWIM protocol)
# Provides leaderless failure detection with O(1) bandwidth, <5s failure detection
swim-p2p>=1.2.0

# PySyncObj - Raft consensus for replicated state (work queue, job assignments)
# Provides automatic leader election with sub-second failover, distributed locks
pysyncobj>=0.3.14

# P2PD - NAT traversal library for UDP/TCP hole punching
# Provides 35-type NAT detection, automatic port forwarding, STUN/TURN support
# Used for Vast.ai CGNAT bypass to improve P2P connectivity
p2pd>=0.2.0

# OpenTelemetry for distributed tracing (per Section 4.3)
opentelemetry-api==1.29.0
opentelemetry-sdk==1.29.0
opentelemetry-exporter-otlp==1.29.0
# Note: Jaeger Thrift exporter is deprecated (1.21.0 is final version).
# Use OTLP exporter with Jaeger's native OTLP endpoint instead.
# Kept for backward compatibility; set OTEL_EXPORTER=otlp for new deployments.
opentelemetry-exporter-jaeger==1.21.0
opentelemetry-instrumentation-fastapi==0.50b0
paramiko>=3.0.0
