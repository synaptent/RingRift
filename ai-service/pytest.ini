# ==============================================================================
# PYTEST CONFIGURATION - Global Test Timeout for CI Safety
# ==============================================================================
# This configuration provides a safety net to prevent tests from hanging
# indefinitely in CI environments. Individual tests may override with
# @pytest.mark.timeout(seconds) when needed.
#
# 60 seconds is generous enough for complex AI training/inference tests while
# still catching infinite loops and hung operations within a reasonable time.
# ==============================================================================

[pytest]
# Python path configuration - ensure project root is on path
pythonpath = .

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Asyncio mode for async tests
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Ensure pytest-timeout is present when timeout options are configured.
required_plugins = pytest-timeout

# Global timeout configuration (pytest-timeout >=2.3.0)
timeout = 60
timeout_method = thread
timeout_func_only = True

# Markers
markers =
    timeout: set custom test timeout (overrides default)
    slow: marks tests as slow (deselect with '-m "not slow"')
    mcts: marks tests as MCTS tests (deselect with '-m "not mcts"', enable with ENABLE_MCTS_TESTS=true)
    gpu: marks tests that require CUDA GPU (skipped when GPU not available)

# Suppress known deprecation warnings from legacy compatibility layers.
filterwarnings =
    ignore:app\._game_engine_legacy is deprecated.*:DeprecationWarning
    ignore:.*IntegratedTrainingManager.*deprecated.*:DeprecationWarning
    ignore:.*orchestrated_training\.py is deprecated.*:DeprecationWarning
    ignore:.*app\.ai\._neural_net_legacy.*deprecated.*:DeprecationWarning
    ignore:.*app\.rules\.legacy is for backward compatibility.*:PendingDeprecationWarning
